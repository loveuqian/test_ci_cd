ENV["FASTLANE_PASSWORD"] = "1HateInstagram1HateInstagram"
ENV["MATCH_KEYCHAIN_PASSWORD"] = "123456"
ENV["APP_IDENTIFIER"] = "com.taglife.taglife2"
ENV["TEAM_ID"] = "H26DA27U2W"
ENV["TEAM_NAME"] = "Alex Petrov"
ENV["FASTLANE_USER"] = "taglife@yandex.ru"
ENV["FASTLANE_SESSION"] = '---\n- !ruby/object:HTTP::Cookie\n  name: DES5c9a8beaa1594b32990e69d5b66458cc1\n  value: HSARMTKNSRVXWFlaT0LcZnz6RtnyWUPsFubG79NPnPmWK47tsMhY0LQ3ZbY8eTUhvdThtBkGBxqjow2zc+EYepkeSDdYTD2qetdQahf7XE+3WhrP1prwcuLeCyEZQWebl01F7kZjo2amdPk4PG8TSRVX\n  domain: idmsa.apple.com\n  for_domain: true\n  path: "/"\n  secure: true\n  httponly: true\n  expires:\n  max_age: 2592000\n  created_at: &1 2020-09-26 12:15:30.166061000 +02:00\n  accessed_at: *1\n- !ruby/object:HTTP::Cookie\n  name: myacinfo\n  value: DAWTKNV297395f5a28e4f91e2968ad38dd3b234c3d58130caae6efe99e9e4320893a9039db8589a4196fb4d2ce24b1a52ffb5585bb34ee27d49f156c6f796a718a791f75677140269219bd0d6008849274055c78966277684654e749b064e1aa6998888f9619695960d19354fbca211730cffcc28f618475310170b9870b10f14598ee3b897f8f096f8a0015f473512842788939d19b1f94e001fe8df2736e28953c1c6a30c89da7b5bea80a0153ed105c93241b2b17339b56d889433389077973cb3f03e57d8fca28f45d500870c17adf45803afe9d567809b6da6ef15b7bedd2bfb5de3e39127973cd9c07cbb2c0bc58800ae2e4db1abbd78e97cbf77c9e913c82fcb04a5c9381889f7270ff2557d9ea606297832525725965d563e5ed558f7a2287a62389d1d25129b58ac0ca35091597165b1c6732081c98d16a95d88af12a5c3ee8f0531c20b553679f5f7be19d6e03d74e6a15343ec08f54292ded7b1aa2c99374b07b8061b6a7e8e7bf6a57f067879a524c67cc8a9e839687a21ad33c76b8b42cc2a918b78001b0cddfe3e508143a5108708d4122af8c2b6498f66b43ff93fb41b065100a3e91f7101776320cc2e9b50e6f7aa747537f09ae0fd734b776a2aa168ca25ea181fa2736d8ea45afd25bf042d913993f33555ad433e8626e53b9f7a5954af1c9df7688cdbc44851c28330a4e85f624ec02f508d1cd26e9b31c73caa1800c8cfd63b7f3dd73b52b234c3c0d9964613930326336383430363162303335356432353636303834613139663837633664376233313833MVRYV2\n  domain: apple.com\n  for_domain: true\n  path: "/"\n  secure: true\n  httponly: true\n  expires:\n  max_age:\n  created_at: 2020-09-26 12:15:30.166307000 +02:00\n  accessed_at: 2020-09-26 16:54:21.924905000 +02:00\n- !ruby/object:HTTP::Cookie\n  name: dqsid\n  value: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MDExMzIwNjIsImp0aSI6Ik9iZVU4Si1IOGJlRGlsN2hvbG1FaHcifQ.Cc-rbAnDLnK_CBEuziD6ZStfksxTA7vY8OOspyR8ukY\n  domain: appstoreconnect.apple.com\n  for_domain: false\n  path: "/"\n  secure: true\n  httponly: true\n  expires:\n  max_age: 1800\n  created_at: &2 2020-09-26 16:54:22.686348000 +02:00\n  accessed_at: *2\n'
ENV["MATCH_PASSWORD"] = "123456"

update_fastlane

default_platform(:ios)

platform :ios do

  desc "Description of what the lane does"
  lane :inc do
    get_build_number
    increment_build_number(xcodeproj: "Qooore.xcodeproj")
    increment_version_number()
  end

  desc "Get certificates"
  lane :get_certificates_or_generate do

    create_keychain(
      name: "KeychainName",
      password: "123456",
      default_keychain: true,
      unlock: true,
      timeout: 3600,
      lock_when_sleeps: true
    )

    get_certificates(
      keychain_path: ENV["CERT_KEYCHAIN_PATH"],
      generate_apple_certs: true,
      username: ENV["FASTLANE_USER"],
      team_id: ENV["TEAM_ID"],
      team_name: ENV["TEAM_NAME"]
    )

    get_provisioning_profile(
      app_identifier: ENV["APP_IDENTIFIER"],
      username: ENV["FASTLANE_USER"],
      team_id: ENV["TEAM_ID"],
      team_name: ENV["TEAM_NAME"],
    )

    gym(
      scheme: "Qooore",
      workspace: "Qooore.xcworkspace",
      clean: true,
      output_directory: './builds',
      output_name: "alpha_qooore",
      silent: false,
      xcargs: "-UseModernBuildSystem=NO",
      include_bitcode: true,
      export_method: "app-store",
      include_symbols: true,
    );

    sh('sh ../.github/scripts/clean_all.sh')
  end
end
